<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Network Topology Builder</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 1200px;
      height: 100%;
      padding: 12px;
      gap: 8px;
    }

    header {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 4px;
    }

    .toolbar button {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #111827;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 14px;
      transition: transform 0.07s ease, box-shadow 0.07s ease, background 0.07s ease;
    }

    .toolbar button:hover {
      background: #1f2937;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
      transform: translateY(-1px);
    }

    .toolbar button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .main {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 10px;
      flex: 1;
      min-height: 0;
    }

    #workspace {
      position: relative;
      background: radial-gradient(circle at top, #1f2937 0, #020617 60%);
      border-radius: 18px;
      border: 1px solid #1f2937;
      overflow: hidden;
      cursor: default;
    }

    .hint {
      position: absolute;
      top: 8px;
      left: 12px;
      font-size: 11px;
      opacity: 0.6;
      pointer-events: none;
    }

    .device {
      position: absolute;
      min-width: 90px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.95);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
      font-size: 12px;
      user-select: none;
      cursor: grab;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .device:active {
      cursor: grabbing;
    }

    .device-type {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.7;
    }

    .device-name {
      font-weight: 600;
    }

    .device-ip {
      font-size: 11px;
      opacity: 0.8;
    }

    /* Right-click context menu */
    .context-menu {
      position: absolute;
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1f2937;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
      z-index: 1000;
      min-width: 150px;
      padding: 4px 0;
      font-size: 13px;
    }

    .context-menu.hidden {
      display: none;
    }

    .context-menu button {
      width: 100%;
      text-align: left;
      padding: 6px 12px;
      background: transparent;
      border: none;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 13px;
    }

    .context-menu button:hover {
      background: #111827;
    }

    /* Details panel */
    #details-panel {
      background: #020617;
      border-radius: 18px;
      border: 1px solid #1f2937;
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 13px;
    }

    #details-panel.hidden {
      display: none;
    }

    #details-panel h2 {
      font-size: 15px;
      margin-bottom: 2px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.7;
    }

    .field input,
    .field textarea,
    .field select {
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      padding: 6px 8px;
      font-size: 13px;
      resize: vertical;
      min-height: 0;
    }

    .field textarea {
      min-height: 90px;
      max-height: 220px;
    }

    .panel-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 4px;
    }

    .panel-buttons button {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #111827;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 13px;
    }

    .panel-buttons button.primary {
      border-color: #22c55e;
    }

    .panel-buttons button.primary:hover {
      background: #16a34a;
    }

    .panel-buttons button.secondary:hover {
      background: #1f2937;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #334155;
      font-size: 11px;
      opacity: 0.85;
      align-self: flex-start;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
    }

    .no-selection {
      opacity: 0.6;
      font-size: 12px;
      margin-top: 8px;
    }

    .small {
      font-size: 11px;
      opacity: 0.7;
    }

    /* Hidden file input */
    #config-file-input {
      display: none;
    }
  </style>
</head>
<body>
<div class="app">
  <header>Network Topology Builder</header>

  <div class="toolbar">
    <button data-device-type="Router">Add Router</button>
    <button data-device-type="Switch">Add Switch</button>
    <button data-device-type="Host">Add Host</button>
  </div>

  <div class="main">
    <!-- Workspace (topology canvas) -->
    <div id="workspace">
      <div class="hint">Left-click to drag devices · Right-click a device for options</div>
    </div>

    <!-- Details / config panel -->
    <aside id="details-panel" class="hidden">
      <h2>Device Settings</h2>
      <div class="badge">
        <span class="badge-dot"></span>
        <span id="panel-device-id">No device selected</span>
      </div>

      <div class="field">
        <label for="panel-name">Name</label>
        <input id="panel-name" type="text" placeholder="R1, SW1, Server01 ...">
      </div>

      <div class="field">
        <label for="panel-type">Type</label>
        <select id="panel-type">
          <option>Router</option>
          <option>Switch</option>
          <option>Host</option>
          <option>Firewall</option>
          <option>Other</option>
        </select>
      </div>

      <div class="field">
        <label for="panel-ip">Management IP</label>
        <input id="panel-ip" type="text" placeholder="10.0.0.1">
      </div>

      <div class="field">
        <label for="panel-config">Config (paste or upload)</label>
        <textarea id="panel-config" placeholder="# Running-config or similar"></textarea>
        <div class="small">Tip: Right-click device → "Upload config file" to import from a file.</div>
      </div>

      <div class="panel-buttons">
        <button class="secondary" id="panel-close">Close</button>
        <button class="primary" id="panel-save">Save</button>
      </div>

      <div id="no-selection" class="no-selection hidden">
        No device selected. Right-click a device and choose "Edit settings".
      </div>
    </aside>
  </div>

  <!-- Custom right-click context menu -->
  <div id="context-menu" class="context-menu hidden">
    <button data-action="edit">Edit settings</button>
    <button data-action="upload-config">Upload config file</button>
    <button data-action="delete">Delete device</button>
  </div>

  <!-- Hidden file input for config uploads -->
  <input type="file" id="config-file-input" accept=".txt,.cfg,.conf,.log,.ini">
</div>

<script>
  // --- State ---
  const workspace = document.getElementById('workspace');
  const contextMenu = document.getElementById('context-menu');
  const configFileInput = document.getElementById('config-file-input');
  const detailsPanel = document.getElementById('details-panel');

  const panelDeviceId = document.getElementById('panel-device-id');
  const panelName = document.getElementById('panel-name');
  const panelType = document.getElementById('panel-type');
  const panelIp = document.getElementById('panel-ip');
  const panelConfig = document.getElementById('panel-config');
  const panelCloseBtn = document.getElementById('panel-close');
  const panelSaveBtn = document.getElementById('panel-save');

  let devices = {};           // id -> { id, type, name, ip, config, x, y }
  let deviceCounter = 1;
  let selectedDeviceId = null;

  // Dragging state
  let draggingDeviceEl = null;
  let dragOffsetX = 0;
  let dragOffsetY = 0;

  // --- Toolbar: add devices ---
  document.querySelectorAll('.toolbar button').forEach(btn => {
    btn.addEventListener('click', () => {
      const type = btn.dataset.deviceType || 'Device';
      addDevice(type);
    });
  });

  function addDevice(type) {
    const id = `D${deviceCounter++}`;
    // Default position in the middle-ish
    const rect = workspace.getBoundingClientRect();
    const x = rect.width / 2 - 40 + (Math.random() * 40 - 20);
    const y = rect.height / 2 - 20 + (Math.random() * 40 - 20);

    const deviceData = {
      id,
      type,
      name: `${type}-${id}`,
      ip: '',
      config: '',
      x,
      y
    };

    devices[id] = deviceData;

    const el = createDeviceElement(deviceData);
    workspace.appendChild(el);
  }

  function createDeviceElement(device) {
    const el = document.createElement('div');
    el.className = 'device';
    el.style.left = `${device.x}px`;
    el.style.top = `${device.y}px`;
    el.dataset.id = device.id;

    el.innerHTML = `
      <div class="device-type">${device.type}</div>
      <div class="device-name">${device.name}</div>
      <div class="device-ip">${device.ip || 'No IP set'}</div>
    `;

    // Dragging with left mouse button
    el.addEventListener('mousedown', (e) => {
      if (e.button !== 0) return; // only left button
      e.preventDefault();
      draggingDeviceEl = el;
      const rect = el.getBoundingClientRect();
      dragOffsetX = e.clientX - rect.left;
      dragOffsetY = e.clientY - rect.top;
    });

    // Custom right-click menu
    el.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      const id = el.dataset.id;
      selectedDeviceId = id;
      showContextMenu(e.pageX, e.pageY);
    });

    // Small UX improvement: double-click opens panel
    el.addEventListener('dblclick', () => {
      selectedDeviceId = el.dataset.id;
      openDetailsPanel();
    });

    return el;
  }

  // --- Dragging logic ---
  document.addEventListener('mousemove', (e) => {
    if (!draggingDeviceEl) return;
    const rect = workspace.getBoundingClientRect();
    let x = e.clientX - rect.left - dragOffsetX;
    let y = e.clientY - rect.top - dragOffsetY;

    // Keep inside workspace bounds a bit
    x = Math.max(0, Math.min(rect.width - 80, x));
    y = Math.max(0, Math.min(rect.height - 40, y));

    draggingDeviceEl.style.left = `${x}px`;
    draggingDeviceEl.style.top = `${y}px`;

    const id = draggingDeviceEl.dataset.id;
    if (devices[id]) {
      devices[id].x = x;
      devices[id].y = y;
    }
  });

  document.addEventListener('mouseup', () => {
    draggingDeviceEl = null;
  });

  // --- Context menu logic ---
  function showContextMenu(x, y) {
    contextMenu.style.left = `${x}px`;
    contextMenu.style.top = `${y}px`;
    contextMenu.classList.remove('hidden');
  }

  function hideContextMenu() {
    contextMenu.classList.add('hidden');
  }

  document.addEventListener('click', (e) => {
    // Hide context menu when clicking elsewhere
    if (!contextMenu.contains(e.target)) {
      hideContextMenu();
    }
  });

  // Global contextmenu on workspace to prevent default menu only on devices
  workspace.addEventListener('contextmenu', (e) => {
    // Allow default right-click on empty workspace
    const deviceEl = e.target.closest('.device');
    if (!deviceEl) return; // default browser menu
  });

  contextMenu.addEventListener('click', (e) => {
    const action = e.target.dataset.action;
    if (!action) return;

    if (!selectedDeviceId || !devices[selectedDeviceId]) {
      hideContextMenu();
      return;
    }

    switch (action) {
      case 'edit':
        openDetailsPanel();
        break;
      case 'upload-config':
        triggerConfigUpload();
        break;
      case 'delete':
        deleteDevice(selectedDeviceId);
        break;
    }

    hideContextMenu();
  });

  // --- Details panel (settings / config) ---
  function openDetailsPanel() {
    const dev = devices[selectedDeviceId];
    if (!dev) return;

    detailsPanel.classList.remove('hidden');
    panelDeviceId.textContent = dev.id;
    panelName.value = dev.name;
    panelType.value = dev.type;
    panelIp.value = dev.ip;
    panelConfig.value = dev.config || '';

    document.getElementById('no-selection')?.classList.add('hidden');
  }

  panelCloseBtn.addEventListener('click', () => {
    detailsPanel.classList.add('hidden');
  });

  panelSaveBtn.addEventListener('click', () => {
    if (!selectedDeviceId) return;
    const dev = devices[selectedDeviceId];
    if (!dev) return;

    dev.name = panelName.value || dev.name;
    dev.type = panelType.value || dev.type;
    dev.ip = panelIp.value || '';
    dev.config = panelConfig.value || '';

    // Update visual element
    const el = workspace.querySelector(`.device[data-id="${dev.id}"]`);
    if (el) {
      el.querySelector('.device-type').textContent = dev.type;
      el.querySelector('.device-name').textContent = dev.name;
      el.querySelector('.device-ip').textContent = dev.ip || 'No IP set';
    }
  });

  // --- Upload config file ---
  function triggerConfigUpload() {
    if (!selectedDeviceId) return;
    configFileInput.value = ''; // reset
    configFileInput.click();
  }

  configFileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file || !selectedDeviceId) return;

    const reader = new FileReader();
    reader.onload = () => {
      const text = reader.result;
      const dev = devices[selectedDeviceId];
      if (!dev) return;
      dev.config = text;

      // If currently shown, update textarea
      if (!detailsPanel.classList.contains('hidden') &&
          panelDeviceId.textContent === dev.id) {
        panelConfig.value = text;
      }

      alert(`Config imported for ${dev.name} (${dev.id})`);
    };
    reader.readAsText(file);
  });

  // --- Optional: start with one example device ---
  addDevice('Router');
</script>
</body>
</html>
